<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="description" content="AWS Serverless Web App tutorial">
    <meta name="keywords" content="HTML,CSS,XML,JavaScript">
    <meta name="author" content="Amir Mersad">
    <meta name="date" content="Jan 2020">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!--Google's MDL-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue-red.min.css" /> 
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    
    <!--Cognito & JavaScript-->
  	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  	<script src="js/amazon-cognito-auth.min.js"></script>
  	<script src="https://sdk.amazonaws.com/js/aws-sdk-2.596.0.min.js"></script> 
  	<script src="./js/amazon-cognito-identity.min.js"></script>   
  	<script src="./js/config.js"></script>
  	<script src="./js/update.js"></script>
  	<script type="text/javascript" src="./js/update.js"></script>
    
    <title>Math</title>
  </head>
  
  <body>
   	<script src="./js/update.js"></script>
  	<script type="text/javascript" src="./js/update.js"></script>
    <!-- Always shows a header, even in smaller screens. -->
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
          <!-- Title -->
          <span class="mdl-layout-title">Math</span>
          <!-- Add spacer, to align navigation to the right -->
          <div class="mdl-layout-spacer"></div>
          <!-- Navigation. We hide it in small screens. -->
          <nav class="mdl-navigation mdl-layout--large-screen-only">
            <a class="mdl-navigation__link" href="./index.html">Home</a>
            <a class="mdl-navigation__link" href="./register.html">Register</a>
            <a class="mdl-navigation__link" href="./sign-in.html">Sign In</a>
   		    <a class="mdl-navigation__link" href="./profile.html">Profile</a>
            <a class="mdl-navigation__link" href="./sign-out.html">Sign Out</a>
          </nav>
        </div>
      </header>
      <div class="mdl-layout__drawer">
        <span class="mdl-layout-title">Math</span>
        <nav class="mdl-navigation">
          <a class="mdl-navigation__link" href="./index.html">Home</a>
          <a class="mdl-navigation__link" href="./register.html">Register</a>
          <a class="mdl-navigation__link" href="./sign-in.html">Sign In</a>
		  <a class="mdl-navigation__link" href="./profile.html">Profile</a>
          <a class="mdl-navigation__link" href="./sign-out.html">Sign Out</a>
        </nav>
      </div>
      <main class="mdl-layout__content">
        <div class="page-content"><!-- Your content goes here --></div>
      </main>
    </div>
    
    <!--Get below the nav menu at the top-->
    <br><br><br>
    
		<div class="container">
      <div>
        <h2>Update Classes</h2>
        <div id='sign-in'>
        </div>
      </div>
		</div>
    
    <div class="mdl-layout mdl-js-layout mdl-color--grey-100">
    	<main class="mdl-layout__content">
    		<div class="mdl-card mdl-shadow--6dp">
    			<div class="mdl-card__title mdl-color--primary mdl-color-text--white">
    				<h2 class="mdl-card__title-text">update your classes</h2>
    			</div>
    	  	<div class="mdl-card__supporting-text">
    				<form action="#">
    					<div class="mdl-textfield mdl-js-textfield">
    						<input class="mdl-textfield__input" type="text" id="period1" />
    						<label class="mdl-textfield__label" for="username">Period 1</label>
    					</div>
    					<div class="mdl-textfield mdl-js-textfield">
    						<input class="mdl-textfield__input" type="text" id="period2" />
    						<label class="mdl-textfield__label" for="userpass">Period 2</label>
    					</div>
						<div class="mdl-textfield mdl-js-textfield">
    						<input class="mdl-textfield__input" type="text" id="period3" />
    						<label class="mdl-textfield__label" for="userpass">Period 3</label>
    					</div>
						<div class="mdl-textfield mdl-js-textfield">
    						<input class="mdl-textfield__input" type="text" id="period4" />
    						<label class="mdl-textfield__label" for="userpass">Period 4</label>
    					</div>
    				</form>
    			</div>
    			<div class="mdl-card__actions mdl-card--border">
    				<button class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" onclick="getUserAttributes();">update</button>
    			</div>
    		</div>
    	</main>
    </div>
    
    <div class="container">
      <div>
        <div id='logged-in'>
          <p></p>
        </div>
      </div>
		</div>
	<script>
		async function update(email_address) {
		// get the user info from API Gate
		period1 =  document.getElementById("period1").value;
		period2 =  document.getElementById("period2").value;
		period3 =  document.getElementById("period3").value;
		period4 =  document.getElementById("period4").value;
		const api_url = 'https://qmvpg5o7v3.execute-api.us-east-1.amazonaws.com/prod/update-classes?' + 'email_address=' + email_address + '&period1=' + period1 + '&period2=' + period2 + '&period3=' + period3+ '&period4=' + period4;
		alert("Updated")
		const api_response = await fetch(api_url);
		const api_data = await(api_response).json();
		console.log(api_data);
		
	}
	function getUserAttributes() {
		var data = { 
			UserPoolId : _config.cognito.userPoolId,
		ClientId : _config.cognito.clientId
		};
		var userPool = new AmazonCognitoIdentity.CognitoUserPool(data);
		var cognitoUser = userPool.getCurrentUser();

		if (cognitoUser != null) {
		cognitoUser.getSession(function(err, session) {
		  if (err) {
			alert(err);
			return;
		  }
		  //console.log('session validity: ' + session.isValid());
		  
		  cognitoUser.getUserAttributes(function(err, result) {
					if (err) {
						console.log(err);
						return;
					}
					// user email address
					console.log(result[2].getValue());
					update(result[2].getValue()) 
				});

		});
		} else {
			console.log("Already signed-out")
		}
	}
</script>
  </body>
</html>
